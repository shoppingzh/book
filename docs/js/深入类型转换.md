# 深入类型转换

## 前言

ES规范中定义了很多类型转换的函数，用于将任意的值转换为指定类型，其中重要的有以下几个：

- `ToBoolean` 转换为布尔类型
- `ToNumber` 转换为数值类型
- `ToString` 转换为字符串类型
- `ToPrimitive` 转换为基本数据类型

以上几种类型转换适用范围非常广，可以说我们无时无刻不在跟它们打交道：

```js
// ToBoolean
if (3) {} // true
if ([]) {} // true
if ('') {} // false

// ToNumber
const a = '3' - 1 // 2

// ToString
'1' + 'hello' // 1hello
[] + 'hello' // hello
{} + 'hello' // [object Object]hello

// ToPrimitive
[1] == '1' // true
[1] == 1 // true
[1] == true //  true
```

如果你对上述代码执行的结果感到意外和困惑，请继续看下去，下面我将逐个解析每个转换函数执行的内在逻辑，最后将所有函数串联起来，深入理解JavaScript类型转换的内涵。

## ToBoolean

ToBoolean对应的API是 `Boolean()`，它的规则非常简单，只要是以下值，便为 `false` ，其他均为 `true`：

- undefined
- null
- +0, -0, 0n, NaN
- ''

::: warning 注意
有趣的是，`document.all` 这个对象进行布尔转换时的结果为 `false` 。

ES规范中特意讲了这个特殊情况：[https://tc39.es/ecma262/multipage/additional-ecmascript-features-for-web-browsers.html#sec-IsHTMLDDA-internal-slot-to-boolean](https://tc39.es/ecma262/multipage/additional-ecmascript-features-for-web-browsers.html#sec-IsHTMLDDA-internal-slot-to-boolean)
:::

> 更多细节请看ES规范：[ES ToBoolean](https://tc39.es/ecma262/multipage/abstract-operations.html#sec-toboolean)

### 场景

以下这些场景都会触发转换布尔值操作：

- `if (test)` `while (test)` `for(;test;)` if/while/for语句的条件判断
- `foo ? a : b` 三元表达式的条件语句
- `a || b` `a && b` 两侧的条件语句

让我们用一些例子来练练手：

```js
if ([]) {} // true
if ({}) {} // true
if ('') {} // false
({}) ? 1 : 2 // 1
0 || [] // []
1 || [] // 1
0 && [] // 0
1 && [] // []
```

## ToPrimitive

该函数用于将 **非基本数据类型** 的值转换为基本数据类型值。

## ToString

该函数用于将任意值转换为字符串类型的值，它的规则如下所示：

1. 如果传入参数为一个字符串，返回这个参数
2. 如果参数为 `undefined` `null` `true` `false`，分别返回 `'undefined'` `'null'` `'true'` `'false'`
3. 如果参数类型为数值(number/bigint)类型，调用数值包装对象的 `toString()` 方法返回字符串
4. 如果参数是对象，则调用 `ToPrimitive` 获得基本数据类型值，如果返回的不是基本数据类型值，则报错（注意！不会递归调用 `ToString`）
5. 如果返回的是基本数据类型值，则继续调用该值的 `ToString` 操作




## ToNumber

<Todo />

