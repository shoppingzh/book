# 执行上下文

执行上下文描述了当前代码执行的情况，了解执行上下文对于理解JavaScript的运行原理至关重要。

但是，JavaScript的运行原理是非常复杂的，有诸多关联概念，在开始学习执行上下文之前，需要充分理解以下概念：

- Environment Records：环境记录，描述当前词法环境
- Realms：领域对象，JavaScript的顶级对象

以下将先从依赖概念开始讲起，使用案例尽可能将概念讲述清楚，如有不正之处，还望读者慷慨指出！

## Environment Records

**环境记录与词法作用域息息相关** ，先看看ES规范中是怎么介绍它的：

> Environment Record is a specification type used to define the association of Identifiers to specific variables and functions, based upon the lexical nesting structure of ECMAScript code. Usually an Environment Record is associated with some specific syntactic structure of ECMAScript code such as a FunctionDeclaration, a BlockStatement, or a Catch clause of a TryStatement. Each time such code is evaluated, a new Environment Record is created to record the identifier bindings that are created by that code.

环境记录通过代码中的嵌套结构来定义标识符与特定变量、函数的关联关系，一般来说，环境记录会在 **函数定义、块定义、catch子句** 开启时创建。


```js
function func(a) { // A区块
  if (a) { // B区块
    conosle.log(a)
  }
}
```

以上代码，创建了两个环境记录对象，一个从A区块开始时创建，一个在B区块开始时创建。 这两个环境记录是不同类型的，后面会提到。

ES规范中，将环境记录分为5种，其中大类分3种，它们的关系如下：

- Declarative Environment Records：声明性环境记录，用于存储变量、函数、类、模块的声明
   - Function Environment Records：函数环境记录，声明性环境记录的子类，从函数定义的区块开始创建，有一些特性（如绑定 `this`）
   - Module Environment Records：模块环境记录，声明性环境记录的子类，从模块定义的区块开始创建
- Object Environment Records：对象环境记录，如果当前区块通过 `with` 创建，则创建了一个对象环境记录
- Global Environment Records：全局环境记录，它是一个对象环境记录与声明性环境记录的复合体，一般而言是单例的

### Declarative Environment Records

### Function Environment Records

### Object Environment Records

### Global Environment Records

